<!DOCTYPE html><html lang='en'><head><title>Pandas, part 2</title><meta charset="utf-8"><style>/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}strong{font-weight:bolder}code{font-family:monospace,monospace;font-size:1em}img{border-style:none}input{font-family:inherit;font-size:100%;line-height:1.15;margin:0}input{overflow:visible}[type=checkbox]{box-sizing:border-box;padding:0}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}blockquote,h1,h2,h3,p,pre{margin:0}ul{list-style:none;margin:0;padding:0}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e2e8f0}img{border-style:solid}input:-ms-input-placeholder{color:#a0aec0}input::-ms-input-placeholder{color:#a0aec0}input::-moz-placeholder{color:#a0aec0}h1,h2,h3{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}input{padding:0;line-height:inherit;color:inherit}code,pre{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}img{display:block;vertical-align:middle}img{max-width:100%;height:auto}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}.bg-gray-200{--bg-opacity:1;background-color:#edf2f7;background-color:rgba(237,242,247,var(--bg-opacity))}.bg-gray-300{--bg-opacity:1;background-color:#e2e8f0;background-color:rgba(226,232,240,var(--bg-opacity))}.bg-orange-300{--bg-opacity:1;background-color:#fbd38d;background-color:rgba(251,211,141,var(--bg-opacity))}.bg-green-200{--bg-opacity:1;background-color:#c6f6d5;background-color:rgba(198,246,213,var(--bg-opacity))}.bg-blue-200{--bg-opacity:1;background-color:#bee3f8;background-color:rgba(190,227,248,var(--bg-opacity))}.bg-blue-300{--bg-opacity:1;background-color:#90cdf4;background-color:rgba(144,205,244,var(--bg-opacity))}.border-gray-400{--border-opacity:1;border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.border-gray-500{--border-opacity:1;border-color:#a0aec0;border-color:rgba(160,174,192,var(--border-opacity))}.border-indigo-500{--border-opacity:1;border-color:#667eea;border-color:rgba(102,126,234,var(--border-opacity))}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.border-solid{border-style:solid}.border{border-width:1px}.border-l-2{border-left-width:2px}.border-t{border-top-width:1px}.cursor-pointer{cursor:pointer}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.justify-center{justify-content:center}.justify-around{justify-content:space-around}.clearfix:after{content:"";display:table;clear:both}.font-sans{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}.font-serif{font-family:Georgia,Cambria,"Times New Roman",Times,serif}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-64{height:16rem}.text-xs{font-size:.75rem}.text-sm{font-size:.875rem}.text-base{font-size:1rem}.text-xl{font-size:1.25rem}.leading-none{line-height:1}.leading-normal{line-height:1.5}.m-2{margin:.5rem}.my-4{margin-top:1rem;margin-bottom:1rem}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mt-4{margin-top:1rem}.mb-4{margin-bottom:1rem}.mt-6{margin-top:1.5rem}.max-w-sm{max-width:24rem}.max-w-2xl{max-width:42rem}.object-contain{-o-object-fit:contain;object-fit:contain}.opacity-0{opacity:0}.overflow-hidden{overflow:hidden}.p-1{padding:.25rem}.p-2{padding:.5rem}.p-3{padding:.75rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.pl-3{padding-left:.75rem}.absolute{position:absolute}.shadow-md{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.shadow-lg{box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05)}.shadow-inner{box-shadow:inset 0 2px 4px 0 rgba(0,0,0,.06)}.text-left{text-align:left}.text-center{text-align:center}.text-black{--text-opacity:1;color:#000;color:rgba(0,0,0,var(--text-opacity))}.text-gray-700{--text-opacity:1;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}.text-gray-800{--text-opacity:1;color:#2d3748;color:rgba(45,55,72,var(--text-opacity))}.whitespace-no-wrap{white-space:nowrap}.w-1\/2{width:50%}.w-2\/3{width:66.666667%}.w-full{width:100%}@media (min-width:768px){.md\:w-2\/3{width:66.666667%}}.text-tiny{font-size:.5rem!important}body{color:#000!important;font-size:1.25rem!important}.main-content{max-width:900px}.lesson{padding-left:15px!important;padding-right:10px!important;--bg-opacity:1;background-color:#edf2f7;background-color:rgba(237,242,247,var(--bg-opacity))}.main-content,html{font-family:Arial,Georgia,Verdana,"Times New Roman"!important}.lesson-footer-card,.lesson-overview-card{font-family:"Times New Roman"!important}.lesson-footer{margin-top:50px;margin-top:20px}.lesson ul{list-style-position:inside;list-style-type:none;margin-left:1em}.lesson ul li{padding-left:1em;padding-right:5px}.lesson ul li::before{content:"‚Ä¢";padding-right:5px}span{white-space:nowrap}p.new{padding-top:0;padding-bottom:.5em}p.new+p{padding-top:.5em}h1,h2,h3{font-weight:700;margin-top:.25em!important;margin-bottom:.05em!important;font-family:Georgia,Cambria,"Times New Roman",Times,serif!important}h1{font-size:2em!important;clear:both;color:#000!important}div+h1,h2{margin-top:0!important}h2{margin-top:.5em!important;font-size:1.5em!important;clear:both;color:#8b0000!important}h3{font-size:1.25em!important;clear:both;color:#006400!important}ul{margin-bottom:30px}p.new a{text-decoration:underline}.lesson a{text-decoration:underline;color:#00f}.title-text{font-size:2rem}blockquote{font-size:1em;background:#f9f9f9;border-left:10px solid #ccc;margin:.5em 10px;padding:.5em 10px;border-left-color:#ffcd69;border-right-color:#f6ba59;quotes:"\201C""\201D""\2018""\2019"}blockquote:before{color:#ccc;content:open-quote;font-size:4em;line-height:.1em;margin-right:.25em;vertical-align:-.4em}blockquote:after{color:#ccc;content:no-close-quote}blockquote p{display:inline}.shadow-lg{box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.5)}img.center{-o-object-position:center;object-position:center;margin-left:auto;margin-right:auto}img.iw400{height:auto;width:auto;max-width:400px}code{font-size:smaller}pre code{font-size:15px}pre code:not(.line-number){background:#f4f4f4;font-family:monospace;font-size:15px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;touch-action:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;clear:both;border:1px solid #ddd;color:#666;page-break-inside:avoid;display:block;min-width:840px;max-width:840px;overflow:scroll;line-height:1.6;margin-bottom:1.6em;padding:1em 1.5em;-moz-tab-size:2;-o-tab-size:2;tab-size:2;word-wrap:break-word;white-space:pre-wrap;border-left:3px solid #f36d33}div.code-starter>pre code{border-left:3px solid #fdff44!important;background-image:radial-gradient(rgba(0,150,0,.75),#000 120%);color:#fff;font:.9rem Inconsolata,monospace}div.code-starter>pre code::after{content:"\a$_"}.tab{font-size:1rem;border-color:#8c6728}.tab-content{max-height:0;max-width:100%;transition:max-height .35s}.tab input:checked~.tab-content{max-height:100vh}.tab input:checked+label{padding:1rem;border-left-width:2px;border-color:#6574cd;background-color:#f8fafc;color:#6574cd}.tab label::after{float:right;right:0;top:0;display:block;width:1em;height:1.5em;line-height:1.5;font-size:1rem;text-align:center;transition:all .35s}.tab input[type=checkbox]+label::after{content:"+";font-weight:700;border-width:1px;border-radius:9999px;border-color:#8c6728}.tab input[type=checkbox]:checked+label::after{transform:rotate(315deg);background-color:#6574cd;color:#f8fafc}</style>
<script src="https://kit.fontawesome.com/7efc4bcee2.js" crossOrigin="anonymous"></script>
<script>
    let stateCheck = setInterval(function(){
      if (document.readyState === 'complete') {
        clearInterval(stateCheck);
        let s1 = document.getElementById('start');
        // console.log('doc is ready', s1);
        if (s1) {
           s1.setAttribute('tabindex', '-1');
           s1.focus(); 
           s1.scrollIntoView({behavior: 'smooth'}); 
           setTimeout(function(){s1.blur()}, 500);
           // console.log('focus set');
        }
      }
    }, 200);
    </script>
</head><body class="lesson"><div class="main-content lesson bg-gray-200 text-black p-1 pl-3 font-serif"><div class="md-inner">
<div id="start" class="section">&nbsp;</div><h1 class="overview"></h1><div class="lesson-overview bg-gray-200 flex justify-center"><div class="text-center px-4 py-2 m-2"><div class="lesson-overview-card displaycard bg-blue-200 max-w-sm rounded overflow-hidden shadow-lg"><div>¬†</div><img alt="Text" class="object-contain h-64 w-full" src="https://raw.githubusercontent.com/habermanUIUC/CodeStoryLessons/main/lessons/p4ds/ds/pandas2/html/ds-sm.png"/><div class="px-6 py-4"><div class="title-text text-center leading-none font-bold text-xl">Pandas, part 2</div><p class="text-center mt-2 text-gray-800 text-xl">Data Analysis: GroupBy and Aggregation</p><div class="text-gray-700 text-base">¬†</div><div class="text-center mb-3"><span class="inline-block bg-gray-300 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 mr-2">#info490</span></div><div class="flex border-t border-solid border-gray-500 shadow-inner justify-around bg-blue-300"><div class="text-gray-700 text-center px-4 m-2 text-sm"><span class="whitespace-no-wrap">üêç¬†¬†4 D.S.</span></div><div class="text-gray-700 text-center px-4 m-2 text-sm"><span class="whitespace-no-wrap"><strong>Version:</strong> <!-- -->SP21</span></div></div><div class="text-gray-700 mt-1 text-center text-tiny">All Rights Reserved</div></div></div></div><div class="text-center px-4 py-2 m-2 w-1/2"><div class="displaycard bg-gray-200 max-w-sm rounded overflow-hidden shadow-lg"><div class="px-6 py-4 text-left"><div class="text-center font-bold text-xl">Pandas, part 2<br/><div><span>prerequisites</span><div class="text-center text-xs mb-2">(start only after finishing)</div><p class="max-w-sm text-gray-800 text-sm">‚¶ø <strong>bootcamp</strong></p><p class="max-w-sm text-gray-800 text-sm">‚¶ø <strong>matplotlib (part 1)</strong></p><p class="max-w-sm text-gray-800 text-sm">‚¶ø <strong>numpy parts 1, 2</strong></p><p class="max-w-sm text-gray-800 text-sm">‚¶ø <strong>pandas part 1</strong></p></div></div></div><div class="px-6 py-4 text-left text-gray-800"><div class="text-center font-bold text-xl">Colab Notes</div><p class="max-w-sm text-sm">1. <strong>Copy</strong> this notebook <img alt="copy2drive.png" class="inline-block" src="https://raw.githubusercontent.com/habermanUIUC/CodeStoryLessons/main/lessons/p4ds/ds/pandas2/html/copy2drive.png"/></p><p class="max-w-sm text-sm">2. <strong>Update</strong> the <strong><code>NET_ID</code></strong> in the notebook</p><p class="max-w-sm text-gray-800 text-sm">3. <strong>Hit ‚ñ∂Ô∏è¬†</strong> to install the INFO 490 IDE</p><div class="text-center font-bold text-xl">¬†</div><div class="text-center font-bold text-xl">Jupyter/PyCharm Notes</div><p class="max-w-sm text-gray-800 text-sm text-left">The testing framework does <strong>not work</strong> (at this time) for Jupyter  notebooks or local code development.</p></div></div></div></div><h1 class="section" id="section1">Pandas, part 2 </h1><h2 id="data-analysis-groupby-and-aggregation">Data Analysis: GroupBy and Aggregation</h2><img alt="ds1.png" class="center iw400" src="https://raw.githubusercontent.com/habermanUIUC/CodeStoryLessons/main/lessons/p4ds/ds/pandas2/html/ds1.png"/><p class="new">This lesson continues our learning of the Pandas library. For this lesson we 
will use the same data set (data.csv: which shows the amount spent on various
 merchants) as the previous lesson:</p><pre><code># accounting data
Date;Merchant;Type;Price;Tax;Total
01/02/2017;Bevande Caf√©;Restaurant; 4.57 ; 0.41 ; 4.98
01/03/2017;Papa Del's Pizza;Restaurant; 17.57 ; 1.58 ; 19.15
01/04/2017;Radio Maria;Restaurant; 56.20 ; 5.06 ; 61.26</code></pre><p class="new">With Pandas we can read in the same data file easily changing the delimiter, 
skipping any comment rows as well:</p><div class="ide code-starter clearfix"><pre><code>import pandas as pd
import LessonUtil as Util
p = Util.path_for_data("data.csv")
df = pd.read_csv(p, skiprows = 1, delimiter=';')
print(df.head(5))</code></pre></div><h1 class="section" id="section2">Grouping</h1><p class="new">We also saw the following aggregation functions in the previous lesson:</p><img alt="ds2.png" class="center iw400" src="https://raw.githubusercontent.com/habermanUIUC/CodeStoryLessons/main/lessons/p4ds/ds/pandas2/html/ds2.png"/><p class="new">As an example:</p><pre><code>print(df['Type'].count())
print(df['Total'].mean())</code></pre><p class="new">These provide a quick summary of all the rows in the DataFrame. However, 
sometimes you want to get subtotals of different sets or groups of data. Pandas 
has a <code>groupby</code> method (much like an SQL Group By statement) that produces a 
<code>DataFrameGroupBy</code> object. You can treat this very much like a DataFrame:</p><div class="ide code-starter clearfix"><pre><code>grp = df.groupby(['Type'])
print(type(grp))</code></pre></div><p class="new">To print out this group, you could do this:</p><pre><code>for key, item in grp:
    print(grp.get_group(key), "\n\n")</code></pre><p class="new">However it's much easier to use one of the aggregates that you want information about the group:</p><pre><code>print(grp.mean())</code></pre><img alt="ds3.png" class="center iw400" src="https://raw.githubusercontent.com/habermanUIUC/CodeStoryLessons/main/lessons/p4ds/ds/pandas2/html/ds3.png"/><p class="new">This creates a very quick pivot table in Pandas (although there is a way to create 
detailed pivot tables in Pandas -- which we can discuss in a subsequent lesson). 
However, the type is actually a <code>Series</code>:</p><pre><code>print(type(grp.mean())</code></pre><h2 id="resetting-the-index">Resetting the Index</h2><p class="new">If you look carefully at the result, you notice that the header consists of two rows</p><pre><code>         Price       Tax     Total
Type</code></pre><p class="new">Also, the 'Index' is now</p><pre><code>['Apparel', 'Grocery', 'Restaurant', 'Technology']</code></pre><p class="new">The columns are:</p><pre><code>['Price', 'Tax', 'Total']</code></pre><p class="new">You can convert the result of the operation to a DataFrame, by resetting its index 
using the method <code>reset_index</code> that assigns a proper index and column headers.</p><img alt="ds4.png" class="center iw400" src="https://raw.githubusercontent.com/habermanUIUC/CodeStoryLessons/main/lessons/p4ds/ds/pandas2/html/ds4.png"/><div class="ide code-starter clearfix"><pre><code>g_f2 = grp.mean().reset_index()
print(g_f2)
print(g_f2.index)
print(g_f2.columns)</code></pre></div><p class="new">Note: you can format the output to 2 decimals with this cryptic line of code:</p><pre><code>pd.options.display.float_format = "{:,.2f}".format</code></pre><p class="new">When you go through the lesson on string formatting, that command will be readable.</p><h2 id="which-columns">Which columns?</h2><p class="new">Take a look at these two statements and the columns in the resulting dataframe:</p><pre><code>print(df.groupby(['Type']).mean())

print(df.groupby(['Type']).count())</code></pre><p class="new">Some of the functions work only on columns whose values are numeric. Pandas is 
smart enough to filter out the non numeric columns for you.</p><p class="new">What's really great is that the type returned from an aggregation on a group 
is another DataFrame. So you can do all things you already know:</p><div class="ide code-starter clearfix"><pre><code>df_mean = df.groupby(['Type']).mean()
print(type(df_mean))
print(df_mean['Price'])</code></pre></div><p class="new">Note that the order of how you select the columns and apply the aggregate does
 not matter:</p><pre><code>a = df.groupby(['Type']).mean()['Price']
b = df.groupby(['Type'])['Price'].mean()
print(a.equals(b))</code></pre><h2 id="group-size">Group Size</h2><p class="new">Once you have a group, you can get the sizes of each of the groups using the <code>size()</code> method:</p><pre><code>grp = df.groupby(['Type'])
print(grp.size())</code></pre><p class="new">The returned value from <code>size()</code> is a Pandas Series. So you can get the number 
of elements in the group using the <code>.size</code> property (see the previous lesson):</p><pre><code>grp = df.groupby(['Type'])
print(grp.size().size)</code></pre><h2 id="back-to-dataframes">Back to DataFrames</h2><p class="new">As mentioned previously, you can convert this series to a DataFrame by 
resetting the index. You can also name the index so you can access the column 
values using labels (as we saw earlier):</p><pre><code>a = df.groupby(['Type']).size()
b = df.groupby(['Type']).size().reset_index(name='count')
print(type(a), '\n', a)
print(type(b), '\n', b)</code></pre><p class="new">However, if you reset_index with <code>inplace=True</code> and set <code>drop=True</code>, it remains 
a series (setting a name on a Series index is not necessary or valid):</p><pre><code>sa = df.groupby(['Type']).size()
sa.reset_index(inplace=True, drop=True)
print(type(sa))</code></pre><p class="new">Of course, once you have your DataFrame, you have full access to all of its great features:</p><div class="ide code-starter clearfix"><pre><code>c = df.groupby(['Type']).size().reset_index(name='count')
more_than_30 = c['count'] &gt; 30 
is_tech      = c['Type'] == 'Technology'
print(c [ more_than_30 | is_tech ])</code></pre></div><h2 id="sorting-and-top-n">Sorting and 'Top N'</h2><p class="new">Getting the top N values of a DataFrame is also a matter of finding the right 
method(s) in the documentation:</p><pre><code>c = c.sort_values('count', ascending=False)
c = c.nlargest(2, 'count')
print(c)</code></pre><h1 class="section" id="section3">Apply(ing)</h1><p class="new">Pandas makes it easy to <em>apply</em> a function to different parts of the data within 
a DataFrame. The tricky part is knowing whether you're dealing with the DataFrame, 
a Series, or Group. How you apply to those objects will be slightly different. </p><p class="new">Let's creates some subsets to work with the examples (you could also use <code>.iloc</code> 
property to grab specific rows and columns (e.g. <code>subset = df.iloc[0:11]</code>):</p><div class="ide code-starter clearfix"><pre><code># dataframes
usd   = df.drop(columns=['Type', 'Date', 'Merchant'])
names = df.drop(columns=['Price', 'Tax', 'Total'])

# series
total = df['Total']

# groupby
grp   = df.groupby(['Type'])

print(type(usd), type(total), type(grp))</code></pre></div><h2 id="apply-to-the-dataframe-by-columns">Apply to the DataFrame (by columns)</h2><p class="new">With the DataFrame apply, you can apply a function to each of the values in the dataset. 
Now let's convert the three dollar-related columns from USD to CAD:</p><pre><code>def usd_to_cad(x_s):
  return x_s*1.33

cad = usd.apply(usd_to_cad)
print(cad)</code></pre><p class="new">The above essentially applies the function to the column series. There's a 
bit more going on here. </p><ul><li>The parameter to the function <code>usd_to_cad(x_s)</code> is a Series (once for each 
column [and an additional time to test if an optimization can be done] ).</li><li>Each Series is then using a universal function (the <code>*</code> in this case) to each
value in the series.</li></ul><h2 id="apply-to-the-dataframe-by-rows">Apply to the DataFrame (by rows)</h2><p class="new">The default for <code>apply</code> is to operate on a Series of column values, however, if 
you want to apply a function to rows, you need to set the <code>axis</code> parameter:</p><div class="ide code-starter clearfix"><pre><code>def together(row):
  m_type = row[0] # row['Type'] will work too
  merc   = row[1] # row['Merchant']
  
  name = m_type[0:5] + ':' + merc[0:5]

  # convert to title case
  return name.title()

df['abbr'] = df[['Type','Merchant']].apply(together, axis=1)
print(df['abbr'])</code></pre></div><p class="new">Note: </p><ul><li>if <code>axis=0</code>, the function would be called twice, once for each column of
values.</li><li>if you wanted to use the new 'abbr' column label, you would need to reset
the index.</li></ul><p class="new">Here's the comment from the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html" target="_blank">documentation</a>.</p><p class="new"><code>DataFrame.apply(func, axis=0, broadcast=None, raw=False, reduce=None, result_type=None, args=(), **kwds)</code></p><blockquote><p class="new">Apply a function along an axis of the DataFrame. Objects passed to the
 function are Series objects whose index is either the DataFrame‚Äôs index (<code>axis=0</code>) 
or the DataFrame‚Äôs columns (<code>axis=1</code>).</p></blockquote><p class="new">This may seem a bit confusing, until you read the specific comment for the <code>axis</code> parameter:</p><p class="new"><code>axis : {0 or ‚Äòindex‚Äô, 1 or ‚Äòcolumns‚Äô}, default 0</code></p><blockquote><p class="new">Axis along which the function is applied:<br/>0 or ‚Äòindex‚Äô: apply function to each column.<br/>1 or ‚Äòcolumns‚Äô: apply function to each row.</p></blockquote><h2 id="apply-to-a-series">Apply to a Series</h2><p class="new">In a Series, apply is passed the individual values:</p><div class="ide code-starter clearfix"><pre><code>def floor(x_s):
  return int(x_s)  # each item
  
total = df['Total']
print(total.apply(floor))</code></pre></div><p class="new">Here's the comment from the documentation:</p><p class="new"><code>Series.apply(func, convert_dtype=True, args=(), **kwds)</code></p><blockquote><p class="new">Invoke function on values of Series. Can be ufunc (a NumPy function that
 applies to the entire Series) or a Python function that only works on single values</p></blockquote><h2 id="apply-to-a-group">Apply to a Group</h2><p class="new">For group apply, the function is passed a DataFrame:</p><div class="ide code-starter clearfix"><pre><code>def simple(x_df):
  # x_df is a dataframe being passed in
  # that represents each group
  return x_df.size
 
p = Util.path_for_data("data.csv")
df = pd.read_csv(p, skiprows = 1, delimiter=';')
grp = df.groupby(['Type'])
print(grp.apply(simple))</code></pre></div><p class="new">Here's the comment from the documentation:</p><p class="new"><code>GroupBy.apply(func, *args, **kwargs)</code>. </p><blockquote><p class="new">Apply function func group-wise and
 combine the results together. The function passed to apply must take a dataframe as its first argument and return a dataframe, a series or a scalar. apply will then take care of combining the results back together into a single dataframe or series. apply is therefore a highly flexible grouping method.</p></blockquote><h1 class="section" id="section4">Aggregation</h1><p class="new">We already have used aggregation functions, however, there is a <code>.aggregation</code> 
method (also <code>.agg</code> for short) to which you can pass an aggregation function. 
Once again, it's important to know on what Pandas object you are aggregating:</p><h2 id="aggregation-on-dataframes">Aggregation on DataFrames:</h2><div class="ide code-starter clearfix"><pre><code>print(usd.sum())</code></pre></div><p class="new">This is equivalent to using the agg method</p><pre><code>print(usd.agg('sum'))</code></pre><h2 id="aggregation-on-series">Aggregation on Series:</h2><div class="ide code-starter clearfix"><pre><code>total = df['Total']
print(total.agg('sum'))</code></pre></div><p class="new">It's important to understand the difference between the two.</p><h2 id="aggregation-on-groupby">Aggregation on GroupBy:</h2><div class="ide code-starter clearfix"><pre><code>print(grp.agg('mean'))</code></pre></div><p class="new">You can even do aggregation on multiple columns:</p><pre><code>print(grp.agg(['sum', 'mean']))</code></pre><p class="new">You can rename the output columns as well: </p><pre><code># drop Date and Merchant columns 
# only to make printing it manageable
df1 = df.drop(columns=['Date', 'Merchant'])

grp = df1.groupby(['Type'])
r1 = grp.agg(['sum', 'nunique'])
r2 = r1.rename(columns={'nunique': 'uniq', 'sum': 'tot'})
print(r2)</code></pre><p class="new">Be sure to type that in and run it.  You should see:</p><pre><code>           Price        Tax       Total     
              tot uniq   tot uniq    tot uniq
Type                                         
Apparel    238.72    4 21.49    4 260.21    4
Grocery     57.13    2  5.14    2  62.27    2
Restaurant 374.29   30 33.69   27 407.98   30
Technology 156.82    2 14.11    2 170.93    2</code></pre><h2 id="chaining-methods">Chaining methods</h2><p class="new">As you solve problems and research Pandas, you may come across code like this (and this is a short one):</p><pre><code>answer = df.groupby(['Type', 'Merchant']).size().nlargest(5).reset_index(name='top')
print(answer)</code></pre><p class="new">Each of the Pandas methods returns an object and that returned object can be operated on as well. 
When you come across code like the above, be assured that the author spent a lot of time with 
the individual pieces before gluing them together in a confusing and almost incoherent (yet supposedly 
impressive) chain. Don't be impressed -- they're hard to read and reason with unless 
you're well versed in the API. </p><h2 id="filtering-groups">Filtering Groups</h2><p class="new">We have seen how to use masks to filter a DataFrame:</p><pre><code>is_tech = df['Type'] == 'Technology'
print(df[is_tech])</code></pre><p class="new">The following example was used earlier showing how to use masks with groups and do more advanced filtering:</p><pre><code>c = df.groupby(['Type']).size().reset_index(name='count')
over_30 = c['count'] &gt; 30 
is_tech = c['Type'] == 'Technology'
print(c [ over_30 | is_tech ])</code></pre><p class="new">The GroupBy object has a <code>.filter()</code> method that you can use with a custom function. 
The function receives a DataFrame and must return a single boolean indicating to keep 
or not keep the group. The two methods <code>.any()</code> and <code>.all()</code> can be used to produce 
a boolean value based on the intermediate arrays that are created with the boolean masks:</p><div class="ide code-starter clearfix"><pre><code>def pass_me(x):

  over_30 = x['Type'].count() &gt; 30
  is_tech = x['Type'] == 'Technology'
  return (over_30 | is_tech).all()

result = df.groupby(['Type']).filter(pass_me)
print(result.groupby(['Type']).size())</code></pre></div><p class="new">Both DataFrames and Series have a <code>.filter</code> method, but each works very 
differently (you don't pass it a function).</p><h2 id="recap">Recap:</h2><p class="new">There's a lot to know in this lesson, but grouping is one of the fundamental 
tasks of using Pandas. The main thing to remember is that Pandas has three 
primary objects: DataFrames, Series, Groupby. And what you can do will 
depend on those objects. </p><h3 id="documentation">Documentation</h3><p class="new">Be sure to visit the references listed at the end of the lesson.
Sometimes it's difficult to figure out if you should use an apply or an aggregation. 
Usually, aggregation is used to reduce a set of values to a single entity and 
apply is used when you need to touch the individual values.</p><div class="font-sans container mt-1 mb-4 "><p>üéóBefore you go, you should <strong>know</strong>:</p><div class="w-2/3 md:w-2/3"><div class="shadow-md"><div class="tab overflow-hidden border-t bg-green-200"><input class="absolute opacity-0" id="tab-multi-0" name="tabs" type="checkbox"/><label class="block p-3 leading-normal cursor-pointer" for="tab-multi-0"><span> how groupby works </span></label><div class="tab-content overflow-hidden border-l-2 bg-orange-300 border-indigo-500 leading-normal"><p class="p-3">No Answer</p></div></div><div class="tab overflow-hidden border-t bg-green-200"><input class="absolute opacity-0" id="tab-multi-1" name="tabs" type="checkbox"/><label class="block p-3 leading-normal cursor-pointer" for="tab-multi-1"><span> how aggregation works </span></label><div class="tab-content overflow-hidden border-l-2 bg-orange-300 border-indigo-500 leading-normal"><p class="p-3">No Answer</p></div></div><div class="tab overflow-hidden border-t bg-green-200"><input class="absolute opacity-0" id="tab-multi-2" name="tabs" type="checkbox"/><label class="block p-3 leading-normal cursor-pointer" for="tab-multi-2"><span> realize that learning Pandas has a shallow learning curve <br/> (e.g. it
takes a long time)¬π </span></label><div class="tab-content overflow-hidden border-l-2 bg-orange-300 border-indigo-500 leading-normal"><p class="p-3">No Answer</p></div></div></div></div></div><h1 class="section" id="section5">Lesson Assignment.</h1><p class="new">For this semester, you can breath a little easy; we removed all the questions for 
this lesson. But it is important to know how Pandas operates. </p><p class="new">HOWEVER, the Pandas project will use many of the concepts taught in this lesson.</p><h1>Test and Submit</h1><p>Once you have finished, you can download your code (via <code>ide.tester</code>) and upload that file to Gradescope (find lesson with tag <strong>DS-Pandas2</strong>).</p><div class="my-4"><pre><code><strong># to list the tests available</strong><br/>print(ide.tester.list_tests())<br/><strong># to perform a specific test</strong><br/>print(ide.tester.test_functionality('name of test'))<br/><strong># to test your code (either works)</strong><br/>print(ide.tester.test_notebook())<br/>print(ide.tester.test_notebook(verbose=True))<br/><strong># to prepare and download your code</strong><br/>ide.tester.download_solution()</code></pre></div><div class="lesson-footer flex bg-gray-200 justify-center"><div class="lesson-footer-card displaycard bg-blue-200 border-t border-gray-400 max-w-2xl rounded overflow-hidden shadow-lg"><div class="px-6 py-4"><div class="title-text text-center font-bold text-xl">Pandas, part 2</div><p class="text-center text-gray-800 text-xl">Data Analysis: GroupBy and Aggregation</p><div class="text-center mt-6 text-xl"><i aria-hidden="true" class="fas fa-tags"></i> any questions on Piazza with <span class="font-bold">DS-Pandas2</span></div><div class="text-gray-700 text-base">¬†</div><div></div><div class="text-gray-700 text-base">References and Additional Readings</div><div class="text-xs p-2 border border-solid border-gray-500 bg-gray-300"> <div class="text-gray-700 px-4 m-2"><span>¬†</span> <strong>Cheat Sheets</strong></div><div class="text-gray-700 px-4 m-2">‚Ä¢ <!-- --> <a href="https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf" target="_blank">https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf</a></div><div class="text-gray-700 px-4 m-2"><span>¬†</span> <strong>DataFrames</strong></div><div class="text-gray-700 px-4 m-2">‚Ä¢ <!-- --> <a href="https://pandas.pydata.org/pandas-docs/version/1.0/reference/frame.html" target="_blank">https://pandas.pydata.org/pandas-docs/version/1.0/reference/frame.html</a></div><div class="text-gray-700 px-4 m-2">‚Ä¢ <!-- --> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html" target="_blank">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html</a></div><div class="text-gray-700 px-4 m-2">‚Ä¢ <!-- --> <a href="http://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.DataFrameGroupBy.agg.html" target="_blank">http://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.DataFrameGroupBy.agg.html</a></div><div class="text-gray-700 px-4 m-2"><span>¬†</span> <strong>Series</strong></div><div class="text-gray-700 px-4 m-2">‚Ä¢ <!-- --> <a href="https://pandas.pydata.org/pandas-docs/version/1.0/reference/series.html" target="_blank">https://pandas.pydata.org/pandas-docs/version/1.0/reference/series.html</a></div><div class="text-gray-700 px-4 m-2">‚Ä¢ <!-- --> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.agg.html" target="_blank">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.agg.html</a></div><div class="text-gray-700 px-4 m-2"><span>¬†</span> <strong>GroupBy</strong></div><div class="text-gray-700 px-4 m-2">‚Ä¢ <!-- --> <a href="https://pandas.pydata.org/pandas-docs/version/1.0/reference/groupby.html" target="_blank">https://pandas.pydata.org/pandas-docs/version/1.0/reference/groupby.html</a></div><div class="text-gray-700 px-4 m-2"><span>¬†</span> <strong>External</strong></div><div class="text-gray-700 px-4 m-2">‚Ä¢ <!-- --> <a href="https://www.webpages.uidaho.edu/~stevel/504/pandas%20dataframe%20notes.pdf" target="_blank">https://www.webpages.uidaho.edu/~stevel/504/pandas%20dataframe%20notes.pdf</a></div><div class="text-gray-700 px-4 m-2">‚Ä¢ <!-- --> <a href="https://s3.amazonaws.com/assets.datacamp.com/blog_assets/PandasPythonForDataScience.pdf" target="_blank">https://s3.amazonaws.com/assets.datacamp.com/blog_assets/PandasPythonForDataScience.pdf</a></div><div class="text-gray-700 px-4 m-2">‚Ä¢ <!-- --> <a href="https://ugoproto.github.io/ugo_py_doc/Pandas_DataFrame_Notes.pdf" target="_blank">https://ugoproto.github.io/ugo_py_doc/Pandas_DataFrame_Notes.pdf</a></div></div><div class="flex mt-4 border-t border-solid border-gray-500 justify-around bg-gray-200"><div class="text-gray-700 text-center px-4 m-2 text-sm">üêç¬†¬†4 D.S.</div><div class="text-gray-700 text-center px-4 m-2 text-sm"><strong>Version:</strong> <!-- -->SP21</div></div><div class="text-gray-700 mt-2 text-center text-sm font-bold">All Rights Reserved Michael Haberman</div><div class="text-gray-700 text-center text-sm">Do not distribute this notebook</div></div></div></div><div>¬†</div><div class="ide code-starter clearfix"><pre><code># print(ide.tester.test_notebook()) 
# print(ide.tester.test_notebook(verbose=True)) 

# once you are ready -- run this 
# ide.tester.download_solution() 
</code></pre></div><h1 class="section" id="section6">Addendum</h1><p class="new">¬π<a href="https://difficultrun.nathanielgivens.com/2014/07/16/steep-learning-curve-doesnt-mean-what-you-think-it-does/" target="_blank">https://difficultrun.nathanielgivens.com/2014/07/16/steep-learning-curve-doesnt-mean-what-you-think-it-does/</a></p><h2 id="display-options">Display Options</h2><p class="new">to print out the full width of columns:</p><pre><code>pd.set_option('display.expand_frame_repr', False)</code></pre><h2 id="plotting">Plotting</h2><p class="new">Since we don't have time to see how visualizations work, here is a quick glimpse into 
the ease you can plot data using Pandas. Pandas puts a simpler API on 
top of Matplotlib. You can also mix using the two libraries with no issues.</p><p class="new">Plotting a graph is just as easy:</p><img alt="ds5.png" class="center iw400" src="https://raw.githubusercontent.com/habermanUIUC/CodeStoryLessons/main/lessons/p4ds/ds/pandas2/html/ds5.png"/><div class="ide code-starter clearfix"><pre><code># plot the average transaction price 
def plot_demo():
    p = Util.path_for_data("data.csv")
    df = pd.read_csv(p, skiprows = 1, delimiter=';')
    pt = df.groupby(['Type']).mean()
    chart = pt['Price'].plot(kind='bar', 
                             fontsize = 8, rot=-45)
    chart.get_figure().savefig('price.png')</code></pre></div><p class="new">However, there's no need to think "why in the world did we spend so much time with Matplotlib?" 
Almost ALWAYS, you end up needing to go down to the Matplotlib level to adjust the graph. 
But to get a quick graph done (exploratory data science), Pandas is great.</p></div></div></body></html>