<!DOCTYPE html><html lang='en'><head><title>Finding Mr. Potter</title><meta charset="utf-8"><style>/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}strong{font-weight:bolder}code{font-family:monospace,monospace;font-size:1em}img{border-style:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}h1,h2,h3,p,pre{margin:0}ul{list-style:none;margin:0;padding:0}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e2e8f0}img{border-style:solid}h1,h2,h3{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}code,pre{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}img,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.bg-gray-200{--bg-opacity:1;background-color:#edf2f7;background-color:rgba(237,242,247,var(--bg-opacity))}.bg-gray-300{--bg-opacity:1;background-color:#e2e8f0;background-color:rgba(226,232,240,var(--bg-opacity))}.bg-blue-200{--bg-opacity:1;background-color:#bee3f8;background-color:rgba(190,227,248,var(--bg-opacity))}.bg-blue-300{--bg-opacity:1;background-color:#90cdf4;background-color:rgba(144,205,244,var(--bg-opacity))}.border-gray-400{--border-opacity:1;border-color:#cbd5e0;border-color:rgba(203,213,224,var(--border-opacity))}.border-gray-500{--border-opacity:1;border-color:#a0aec0;border-color:rgba(160,174,192,var(--border-opacity))}.border-gray-600{--border-opacity:1;border-color:#718096;border-color:rgba(113,128,150,var(--border-opacity))}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.border-solid{border-style:solid}.border-0{border-width:0}.border{border-width:1px}.border-t{border-top-width:1px}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.justify-center{justify-content:center}.justify-around{justify-content:space-around}.float-right{float:right}.float-left{float:left}.clearfix:after{content:"";display:table;clear:both}.clear-both{clear:both}.font-serif{font-family:Georgia,Cambria,"Times New Roman",Times,serif}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-64{height:16rem}.text-xs{font-size:.75rem}.text-sm{font-size:.875rem}.text-base{font-size:1rem}.text-xl{font-size:1.25rem}.leading-none{line-height:1}.m-1{margin:.25rem}.m-2{margin:.5rem}.my-4{margin-top:1rem;margin-bottom:1rem}.my-6{margin-top:1.5rem;margin-bottom:1.5rem}.mt-1{margin-top:.25rem}.mb-1{margin-bottom:.25rem}.mt-2{margin-top:.5rem}.mr-2{margin-right:.5rem}.mb-2{margin-bottom:.5rem}.mt-3{margin-top:.75rem}.mr-3{margin-right:.75rem}.mb-3{margin-bottom:.75rem}.ml-3{margin-left:.75rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.max-w-sm{max-width:24rem}.max-w-2xl{max-width:42rem}.object-contain{-o-object-fit:contain;object-fit:contain}.overflow-hidden{overflow:hidden}.p-1{padding:.25rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.pl-3{padding-left:.75rem}.shadow-lg{box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05)}.shadow-inner{box-shadow:inset 0 2px 4px 0 rgba(0,0,0,.06)}.text-left{text-align:left}.text-center{text-align:center}.text-black{--text-opacity:1;color:#000;color:rgba(0,0,0,var(--text-opacity))}.text-gray-700{--text-opacity:1;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}.text-gray-800{--text-opacity:1;color:#2d3748;color:rgba(45,55,72,var(--text-opacity))}.whitespace-no-wrap{white-space:nowrap}.w-1\/2{width:50%}.w-full{width:100%}.text-tiny{font-size:.5rem!important}body{color:#000!important;font-size:1.25rem!important}.main-content{max-width:900px}.lesson{padding-left:15px!important;padding-right:10px!important;--bg-opacity:1;background-color:#edf2f7;background-color:rgba(237,242,247,var(--bg-opacity))}.main-content,html{font-family:Arial,Georgia,Verdana,"Times New Roman"!important}.lesson-footer-card,.lesson-overview-card{font-family:"Times New Roman"!important}.lesson-footer{margin-top:50px;margin-top:20px}video{height:auto;padding:.25rem;background-color:#87cefa;margin:0!important;padding:0!important}.lesson ul{list-style-position:inside;list-style-type:none;margin-left:1em}.lesson ul li{padding-left:1em;padding-right:5px}.lesson ul li::before{content:"•";padding-right:5px}span{white-space:nowrap}p.new{padding-top:0;padding-bottom:.5em}p.new+p{padding-top:.5em}h1,h2,h3{font-weight:700;margin-top:.25em!important;margin-bottom:.05em!important;font-family:Georgia,Cambria,"Times New Roman",Times,serif!important}h1{font-size:2em!important;clear:both;color:#000!important}div+h1,h2{margin-top:0!important}h2{margin-top:.5em!important;font-size:1.5em!important;clear:both;color:#8b0000!important}h3{font-size:1.25em!important;clear:both;color:#006400!important}ul{margin-bottom:30px}p.new a{text-decoration:underline}.lesson a{text-decoration:underline;color:#00f}.title-text{font-size:2rem}.shadow-lg{box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.5)}img.formula-block{margin-left:auto;margin-right:auto;margin-top:.25rem;margin-bottom:.75rem}img.center{-o-object-position:center;object-position:center;margin-left:auto;margin-right:auto}img.border{border:1px solid #021a40;margin-top:.5rem;margin-bottom:.75rem}img.iw400{height:auto;width:auto;max-width:400px}img.iw500{height:auto;width:auto;max-width:500px}img.iw300{height:auto;width:auto;max-width:300px}img.iw200{height:auto;width:auto;max-width:200px}img.iw100{height:auto;width:auto;max-width:100px}code{font-size:smaller}pre code{font-size:15px}pre code:not(.line-number){background:#f4f4f4;font-family:monospace;font-size:15px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default;touch-action:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;clear:both;border:1px solid #ddd;color:#666;page-break-inside:avoid;display:block;min-width:840px;max-width:840px;overflow:scroll;line-height:1.6;margin-bottom:1.6em;padding:1em 1.5em;-moz-tab-size:2;-o-tab-size:2;tab-size:2;word-wrap:break-word;white-space:pre-wrap;border-left:3px solid #f36d33}div.code-starter>pre code{border-left:3px solid #fdff44!important;background-image:radial-gradient(rgba(0,150,0,.75),#000 120%);color:#fff;font:.9rem Inconsolata,monospace}div.code-starter>pre code::after{content:"\a$_"}</style>
<script src="https://kit.fontawesome.com/7efc4bcee2.js" crossOrigin="anonymous"></script>
<script>
    let stateCheck = setInterval(function(){
      if (document.readyState === 'complete') {
        clearInterval(stateCheck);
        let s1 = document.getElementById('start');
        // console.log('doc is ready', s1);
        if (s1) {
           s1.setAttribute('tabindex', '-1');
           s1.focus(); 
           s1.scrollIntoView({behavior: 'smooth'}); 
           setTimeout(function(){s1.blur()}, 500);
           // console.log('focus set');
        }
      }
    }, 200);
    </script>
</head><body class="lesson"><div class="main-content lesson bg-gray-200 text-black p-1 pl-3 font-serif"><div class="md-inner">
<div id="start" class="section">&nbsp;</div><h1 class="section" id="section3">Measuring Similarity</h1><img alt="HPImposter.png" class="iw200 bg-blue-200 float-right ml-3 border mt-1 py-3" src="https://raw.githubusercontent.com/habermanUIUC/CodeStoryLessons/main/lessons/dmap/projects/hp411/html/HPImposter.png"/><p class="new">Here's where you are: </p><ul><li>You have a document matrix, where each row represents a Harry Potter book (td•idf values).</li><li>You have a query vector, where each column represents a tf value for each word
(actually it's a tf•idf value, but all the idf values are 1.  Do you know why?)</li></ul><p class="new">NOW, we just need to measure how similar the query vector (a single document) 
is to each row in the matrix. The row in the matrix that is most similar to the query wins. 
We need a way to compare two vectors and determine how 'similar' they are. </p><h2 id="close-but-not-good-enough">Close, but not good enough</h2><p class="new">One easy way to think about calculating similarity is using the distance
 formula between two points. Each point has an x and y component.  So each
 point is a vector of length two. And the distance between two points is
 simply the square root of the sum of squared differences:</p><img alt="math?math=%5CLarge%20distance(p1%2Cp2)%20%3D%20%5Csqrt%7B%20(p1.x%20-%20p2.x)%5E2%20%2B%20(p1.y%20-%20p2.y)%5E2%7D" class=" formula-block" src="https://render.githubusercontent.com/render/math?math=%5CLarge%20distance(p1%2Cp2)%20%3D%20%5Csqrt%7B%20(p1.x%20-%20p2.x)%5E2%20%2B%20(p1.y%20-%20p2.y)%5E2%7D"/><p class="new">However, this formula has some issues that we will discuss in detail on a
 lesson that covers different distance metrics.  For now, we are going to use a
metric called cosine similarity -- which is used for determining how close 
two documents (as vectors) are (because it normalizes the length of each
 document).  </p><h2 id="cosine-distancesimilarity">Cosine Distance/Similarity</h2><p class="new">One of the main metrics for working with document vectors is cosine similarity. 
This metric relies on normalizing the two input vectors so that 'bigger' (i.e. longer') 
vectors don't over influence the calculation (e.g. just because a document 
contains more words doesn't make it more important).</p><p class="new">We can visualize cosine similarity (the value of 𝛳 in the image below) to show
the distance between to words (the value d represents euclidean distance):
<img alt="eucos.png" class="my-6 border iw300 center" src="https://raw.githubusercontent.com/habermanUIUC/CodeStoryLessons/main/lessons/dmap/projects/hp411/html/eucos.png"/>Specifically the the cosine distance is defined as: 
<img alt="math?math=%5CLarge%20cosine%5C_similarity(A%2C%20B)%20%3D%20%5Cfrac%7BA%20%5Ccdot%20B%0A%7D%7B%5Cleft%20%5C%7C%20A%20%5Cright%20%5C%7C%5Cleft%20%5C%7C%20B%20%5Cright%20%5C%7C%7D" class="my-4 center formula-block" src="https://render.githubusercontent.com/render/math?math=%5CLarge%20cosine%5C_similarity(A%2C%20B)%20%3D%20%5Cfrac%7BA%20%5Ccdot%20B%0A%7D%7B%5Cleft%20%5C%7C%20A%20%5Cright%20%5C%7C%5Cleft%20%5C%7C%20B%20%5Cright%20%5C%7C%7D"/>However, we will wait until the lesson on metrics to discuss (in great detail) the 
meaning of both <img alt="math?math=%5CLarge%20A%20%5Ccdot%20B" class="inline formula-block" src="https://render.githubusercontent.com/render/math?math=%5CLarge%20A%20%5Ccdot%20B"/> (dot product) and 
<img alt="math?math=%5CLarge%20%5Cleft%20%5C%7C%20A%20%5Cright%20%5C%7C" class="inline formula-block" src="https://render.githubusercontent.com/render/math?math=%5CLarge%20%5Cleft%20%5C%7C%20A%20%5Cright%20%5C%7C"/> (vector (L2) normalization). 
You can say the cosine distance between two vectors looks at the angle between 
the two and not their magnitude.</p><p class="new">Luckily we can use sklearn's metrics for similarity. The nice thing about sklearn's 
metrics is that they automatically work with sparse matrices. The following 
shows how to use the metric:</p><pre><code>from sklearn.metrics.pairwise import cosine_similarity
def print_matching_document(matrix, q_vector):

  assert q_vector.shape[0] == 1, "bad query vector (wrong size)"

  for m_idx, m in enumerate(matrix):
    for q_idx, q in enumerate(q_vector):
      print(cosine_similarity(m,q))</code></pre><p class="new">This is the first time we are seeing the <code>assert</code> operator.  It will throw a
 run time exception if the condition is not met (and print the corresponding
 message).  However, in production code, you will usually automatically
 remove them.  They are a great tool while developing code to help capture
 the semantics of a possible error.</p><p class="new">Also note (when you run this code) the returned value from <code>cosine_similarity</code>. Be 
sure to type the above code in and run it. It will help. </p><p class="new">With that as an example, finish the following code block:</p><ul><li><code>find_matching_document</code> returns a tuple of the index and distance of the <code>matrix</code> 
that is closest to <code>q_vector</code>
<ul><li>the first value of the tuple is the index, the second is the the distance</li></ul></li><li><code>find_match</code> builds the query vector from the query string
  <ul><li>use the <code>TfidfVectorizer</code>'s <a href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.TfidfVectorizer.html" target="_blank">transform</a> method</li><li>it's essentially the same as <code>prepare_query_v1</code></li><li>returns the value from <code>find_matching_document</code></li></ul></li></ul></div></div></body></html>